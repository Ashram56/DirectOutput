ini files {#inifiles}
================

\section inifiles_introduction Introduction

The DirectOutput framework supports the use of the legacy LedControl.ini files as well as the extended directoutputconfig.ini files as generated by the Ledwiz config tool to control the cabinet outputs.
Since this framework supports the use of more than one output controller/LedWiz, the use of more than one such file is supported as well.

To facilitate the use of the framework, the auto config function will automatically load ini files and select a table config from the data based on the RomName, if no xml table config can be found. But even if a xml table config file is available is is possible to use the directoutputconfig.ini/ledcontrol.ini configs together with xml table configs by setting the right option in the xml table config. 

If you dont have a directoutputconfig.ini file for your cabinet, it is best if you go to the <a href="http://vpuniverse.com/ledwiz/login.php">LedWiz ConfigTool Website</a> and create a file matching your cabinet.

\image html LedWizConfigTool.jpg LedWiz ConfigTool 


\section inifiles_configloading Configuration loading

Depending on the settings in the global config file, the framework will either load the ini files specified in the global config or it will try to detect the ini files automatically.

If entries for ledcontrol files exist in the global config (see \ref globalconfig "global config documentation"), the framework will use those files for configuration and check only these files for table settings.

If the global config doesn't specify any ini files, the system will go into automatic configuration mode, in which it tries to detect and load global config files automatically.

\subsection inifiles_auto Automatic configuration

\subsubsection inifiles_autolocations File locations and names

In auto config mode the DirectOutput framework tries to locate the files in the following locations:

* __Table directory__ as specified in the table name para when the framework is initialized.
* __Global config directory__ which is usualy a subdirectory named config within the installation directory of the framework.
* __Installation directory__ which is the directory containg the DirectOutput.dll.

DOF will check each of these directories for ini files containg configurations. These files can have the following names:

* __directoutputconfig.ini__ resp. __directoutputconfig{Number}.ini__ are the files for which the framework is looking first.
* __ledcontrol.ini__ resp. __ledcontrol{Number}.ini__ are the names the framework is looking for if no files named _directoutputconfig.ini__ can be found.

Based on the loaded files, the system will configure the DirectOutput framework.

\subsection inifiles_autoconfigcabinet Cabinet configuration


\subsection inifiles_autoconfignumbering LedControl file numbering

If auto configuration is used and no definitions for directoutputconfig.ini resp. ledcontrol.ini files exist in global config, the framework requires the files to be numbered. (directoutputconfig.ini, directoutputconfig2.ini, directoutputconfig3.ini or ledcontrol.ini, ledcontrol2.ini, ledcontrol3.ini and so on).

DOF uses these numbers to determine which LedWizEquivalent toy should be configured by the ledcontrol file, by match the number of the ledcontrol file against the number of the LedWizEquivalent toy. If the ledcontrol files are defined in the global config the ledwiznr of the definition will be used instead of the number in the filename.

Auto cabinet config does, if active, number the detected output controllers resp. their related LedWizEquivalent toys as follows:

* For LedWiz unit 1-16, the framework creates one LedWizEquivalent per unit having the same number as the LedWiz (LedWiz nr. = LedWizEquivalent nr. = ledcontrol file number).
* For PacLed64 units (max 4 supported), the framework creates 2 LedWizEquivalentToys per unit covering the whole 64 outputs. The numbering for those LedWizEquivalent start at 20, so PacLed64 id 1 can be accessed through LedWizEquivalents number 20 & 21, PacLed id 2 uses 22 & 23 and so on.


\section inifiles_manualconfig Manual Configuration

Instead of relying on the automatic cabinet config, you can also specifiy your own cabinet configuration for the use with LedControl.ini files.

To be usable for the LedControl functions of the framework, the list of toys in the cabinet must contain one or several LedWizEquivalent IToy objects and the outputs for the LedWizEquivalents. Normaly the outputs of the LedWizEquivalent toys will point to the outputs of a single LedWiz IOutputController, but you are free to point to any other output of any IOutputController configured in your system (e.g. you could use outputs of 2 different LedWiz controllers in one LedWizEquivalent toy).

When LedControl data is used for the Table configuration, the number of the LedWizEquivalent is used to match to the correct LedControl.ini file (e.g. LedControl3 will configure LedWizEquivalent nr. 3). 

\section inifiles_settings Settings in DirectOutputConfig/LedControl files

This is a short overview on the settings in directoutput.ini  files.

\subsection inifiles_settingscolors Colors Section

The first section in a directoutputconfig.ini file is the Colors section. It starts with the header [Colors_DOF] and a empty line following the header. After the header one or several colors are specified by a name and the brighness of 3 color components (red, green, blue) or 4 color components (red, green, blue, alpha). The values of the components have a range of 0 (off resp. fully transparent for alpha) to 48 (max brightness resp. fully opaque for alpha). For color specifications without a alpha component, alpha will be set to 0 (transparent) if all components are set to 0 (resulting in black). All other definitions will have a alpha value of 255 (fully opaque).

A colors section might looks as follows:
~~~~~~~~~~~~~~~~~~~~~~~~~{.ini}
[Colors DOF]

Black=0,0,0
White=48,48,48,48
Red=48,0,0,255
SemitransparentRed=48,0,0,24
.. more color definitions ....
Brown=24,12,0

~~~~~~~~~~~~~~~~~~~~~~~~~

\subsection inifiles_settingsconfigouts Config DOF Section

The most important section in a directoutputconfig.ini file is the [Config DOF] section. It contains the effect definitions for the various tables.

Each line in this section contains the definition for a single table. The lines start with a short version of the romname of the table or a fake romname for EM tables. After the romname, there can be up to 32 columns (separated by commas) containing the settings for every output of a ledwiz resp. the internal representation of a ledwiz (Column 1 is output 1, column 2 is output 2 and so on).

Every column can contain any number of definitions how the framework should control the output. If more than one definition exists for a column, these definitions have to be separated by forward dashes (/).

The following definitions can be used to specifiy the output behaviour of the physical outputs. Definitions can consist of up to three parts each containing one setting separated by a space.

If you want to create your own settings, it is best if you use the <a href="http://vpuniverse.com/ledwiz/login.php">LedWiz ConfigTool Website</a> and try to learn from the settings found there. In addition it is recommended that you use the LedControlFileTester.exe (explained in the next section) to check if your files can be parsed, if you create your own settings.


\subsection inifiles_settingspara Setting parameters

The first part of a setting for a column must always be one of the following:

* __TableElementTypeChar plus Number__ (e.g. S48 for solenoid 48) determines which table element is controlling the specified effect.
* __On__ resp. __1__ turns the specified effect constantly on.
* __B__ defines a static (not externaly controlled) blinking.

The second and following parts can contain the following:
* __Color name__ as specified in the colors section of the file. Only valid as the second value.
* __Hex color definition__ (e.g. #ff0000ff for opaque red). Take note that these color definitions allow for values from 0-255 in contrast to the colors section which only support 0-48. Hex color definitions can contain 3 or 4 parts (without or with alpha value). Setting is only accepted as the second value.
* __Blink__ defines blinking with a default interval of 500ms.
* __I{Number}__ defines a intensity between 0 (off) and 48 (fully on) for the effect. This settings is only valid for effect settings without a color definition and controlling only a single output.
* __L{Number}__ defines the layer on which the setting operates. In most cases the setting is not required, since DOF will assign ascending layer numbers to the settings for a column anyway.
* __W{NumberOfMilliseconds}__ defines a wait period resp. delay before the effect executes after it has been triggered.
* __M{NumberOfMilliseconds}__ defines the minimum duration for the effect in milliseconds.
* __F{NumberOfMilliseconds}, FU{NumberOfMilliseconds}, FD{NumberOfMilliseconds}__ are used to specify the fading duration in milliseconds. _F_ sets the duration for both fading up and down, _FU_ controls fading up anly and _FD_ fading down only.
* __Numeric Values__ without any extra character can be used to specify the duration of the effect or the blinking behaviour. If blinking has been defined, one or two numeric values are parsed. Value 1 controls the blink interval in milliseconds, while value 2 defines the number of blinks. If no blinking has been defined, only one numeric values which is used to defined the duration of the effect in milliseconds is parsed.

\subsection inifiles_settingspara Setting examples

* __S48__ will turn the toy associated with the column on and off depending on the state of solenoid 48.
* __S48 Green__ will set the rgb led associated with the column of the file to green depending on the state of solenoid 48.
* __S48 Green Blink__ will set the rgb led associated with the column of the file to green blinking depending on the state of solenoid 48.
* __W32 Red Blink 250 5__ will make a rgbled blink red for 5 times with a interval of 250ms when switch 32 is activated.
* __W36 I32__ sets the output associated with the column to intensity 32 as long as switch 32 is active.


\section inifiles_testingapp LedControl File Testing Application

The package of the DirectOutput framework does also contain a small tool named _LedControlFileTester.exe_ which can be used to test wether the contents of a directouput.ini resp. ledcontrol.ini file can be read and understood be the DirectOutput framework.

The tool can by started directly with a double click like any other program, but it can also be used from the command line.

For command line usem you have to specify a single parameter with the name and path to your config file:

~~~~~~~~~~~~~~~{.bat}
LedControlFileTester.exe DirectOutputConfig.ini
~~~~~~~~~~~~~~~

If the file is OK, the tool will output a small notification message in the command window. If there are problems in the ledcontrol file, the tool will open a window where you can see the messages returned by the ledcontrol file parser.

\image html LedControlFileTester.jpg Test results showing a problem in a config file.

\warning This tool does only check if the basic structure of the file is correct and wether all settings can be parsed. It does NOT check if settings make sense (e.g. if a settings exists for a non existing table element).


